{"ast":null,"code":"import _regeneratorRuntime from\"/Users/pavlo/Desktop/react-pizza-main/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/pavlo/Desktop/react-pizza-main/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _toConsumableArray from\"/Users/pavlo/Desktop/react-pizza-main/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/pavlo/Desktop/react-pizza-main/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React from\"react\";import Skeleton from'../components/PizzaBlog/Skeleton';import PizzaBlog from'../components/PizzaBlog';import Categories from'../components/Сategories';import Sort from'../components/Sort';import Pagination from'../components/Pagination';import{list}from'../components/Sort';import NoContent from'../components/NoContent';import qs from'qs';import{useNavigate,Link}from\"react-router-dom\";import{useSelector,useDispatch}from'react-redux';import{setCategoryId,setCurrentPage,setParams,selectFilter}from'../Redux/Slices/filterSlice';import{fetchPizzas,selectPizza}from'../Redux/Slices/pizzaSlice';// import { newDispatch } from '../Redux/store'\nimport{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=function Home(){var isSearch=React.useRef(false);var isMounter=React.useRef(false);//хуки\nvar navigate=useNavigate();var dispatch=useDispatch();var _useSelector=useSelector(selectFilter),sort=_useSelector.sort,CategoryId=_useSelector.CategoryId,currentPage=_useSelector.currentPage,searchValue=_useSelector.searchValue;//Данные\n// const PizzasFilter = statePizzas.filter((obj) => obj.title.toLowerCase().includes(searchValue.toLowerCase().trim()) ? true : false)\nvar _useSelector2=useSelector(selectPizza),pizzas=_useSelector2.pizzas,status=_useSelector2.status,message=_useSelector2.message;var Pizzas=pizzas.map(function(obj){return/*#__PURE__*/_jsx(PizzaBlog,_objectSpread({},obj),obj.id.toString());});var SkeletonArr=_toConsumableArray(new Array(6)).map(function(el,index){return/*#__PURE__*/_jsx(Skeleton,{},index);});//запросы\nvar order=sort.sortProperty.split('')[0]==='-'?'desc':'asc';var sortPut=sort.sortProperty.replace('-','');var category=CategoryId>0?\"&category=\".concat(CategoryId):'';var search=searchValue?\"search=\".concat(searchValue):'';// запрос на сервер\nfunction PizzasFetch(){return _PizzasFetch.apply(this,arguments);}// если есть URL парсим обьект, передаем в стейт, даем запрос на сервер \nfunction _PizzasFetch(){_PizzasFetch=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch(fetchPizzas({order:order,sortPut:sortPut,category:category,search:search,currentPage:currentPage}));window.scrollTo(0,0);case 2:case\"end\":return _context.stop();}}},_callee);}));return _PizzasFetch.apply(this,arguments);}React.useEffect(function(){if(window.location.search){var params=qs.parse(window.location.search.substring(1));dispatch(setParams(_objectSpread(_objectSpread({},params),{},{sort:list.find(function(el){return el.sortProperty===params.sortProperty;})})));}isSearch.current=true;// говорим, что диспатч выполнил свою работу\n},[]);//если не было запроса по втановленому URL ( так как выше функция не исполнилась и не изменила на true)\nReact.useEffect(function(){window.scrollBy(0,0);// выполняется толкьо после смены isSearch.current = true \n//  если нет URL вставленого, то отправляем запрос по дефолту с инишелСтейт\nif(!isSearch.current){PizzasFetch();}isSearch.current=false;// я сделал по своему так: у меня по другому не работает> оставлю на всякий \n// если нет URL вставленого, то отправляем запрос по дефолту с инишелСтейт\nif(window.location.search===''){PizzasFetch();}},[CategoryId,sort,currentPage,searchValue]);// если второй и более рендеринг - вставляем URL прийдящий с state\nReact.useEffect(function(){if(isMounter.current){var queryString=qs.stringify({sortProperty:sort.sortProperty,CategoryId:CategoryId,currentPage:currentPage});navigate(\"?\".concat(queryString));}isMounter.current=true;},[CategoryId,sort,currentPage]);function setСategories(index){dispatch(setCategoryId(index));}// или сразу можно передать в пропсы этот кол бек \nfunction onChangeCurrent(n){dispatch(setCurrentPage(n));}return/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"content__top\",children:[/*#__PURE__*/_jsx(Sort,{}),/*#__PURE__*/_jsx(Categories,{value:CategoryId,onClickCategories:setСategories})]}),/*#__PURE__*/_jsx(\"h2\",{className:\"content__title\",children:\"\\u0412\\u0441\\u0435 \\u043F\\u0438\\u0446\\u0446\\u044B\"}),/*#__PURE__*/_jsx(\"div\",{className:\"content__items\",children:message==='Пиц не найдено'?/*#__PURE__*/_jsxs(\"div\",{children:[\" \\u043F\\u0438\\u0446 \\u043D\\u0435\\u0442\\u0443 \\u0443\\u0445\\u043E\\u0434\\u0438 / message: \",message,\" \"]}):status==='error'?/*#__PURE__*/_jsx(NoContent,{}):status==='pending'?SkeletonArr:Pizzas})]}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,onChangeCurrent:onChangeCurrent})]});};export default Home;","map":{"version":3,"names":["React","Skeleton","PizzaBlog","Categories","Sort","Pagination","list","NoContent","qs","useNavigate","Link","useSelector","useDispatch","setCategoryId","setCurrentPage","setParams","selectFilter","fetchPizzas","selectPizza","Home","isSearch","useRef","isMounter","navigate","dispatch","sort","CategoryId","currentPage","searchValue","pizzas","status","message","Pizzas","map","obj","id","toString","SkeletonArr","Array","el","index","order","sortProperty","split","sortPut","replace","category","search","PizzasFetch","window","scrollTo","useEffect","location","params","parse","substring","find","current","scrollBy","queryString","stringify","setСategories","onChangeCurrent","n"],"sources":["/Users/pavlo/Desktop/react-pizza-main/src/Pages/Home.jsx"],"sourcesContent":["import React from \"react\";\nimport Skeleton from '../components/PizzaBlog/Skeleton';\nimport PizzaBlog from '../components/PizzaBlog';\nimport Categories from '../components/Сategories';\nimport Sort from '../components/Sort';\nimport Pagination from '../components/Pagination'\nimport { list } from '../components/Sort'\nimport NoContent from '../components/NoContent'\nimport qs from 'qs'\nimport { useNavigate, Link } from \"react-router-dom\";\nimport { useSelector, useDispatch } from 'react-redux'\nimport { setCategoryId, setCurrentPage, setParams, selectFilter, } from '../Redux/Slices/filterSlice'\nimport { fetchPizzas, selectPizza } from '../Redux/Slices/pizzaSlice'\n// import { newDispatch } from '../Redux/store'\n\nconst Home = () => {\n    const isSearch = React.useRef(false)\n    const isMounter = React.useRef(false)\n    //хуки\n    const navigate = useNavigate()\n    const dispatch = useDispatch()\n    const { sort, CategoryId, currentPage, searchValue } = useSelector(selectFilter)\n    //Данные\n    // const PizzasFilter = statePizzas.filter((obj) => obj.title.toLowerCase().includes(searchValue.toLowerCase().trim()) ? true : false)\n    const { pizzas, status, message } = useSelector(selectPizza)\n    const Pizzas = pizzas.map((obj) => {\n        return <PizzaBlog key={obj.id.toString()} {...obj} />\n    })\n    const SkeletonArr = [...new Array(6)].map((el, index) => < Skeleton key={index} />)\n    //запросы\n    const order = sort.sortProperty.split('')[0] === '-' ? 'desc' : 'asc';\n    const sortPut = sort.sortProperty.replace('-', '');\n    const category = CategoryId > 0 ? `&category=${CategoryId}` : '';\n    const search = searchValue ? `search=${searchValue}` : ''\n    // запрос на сервер\n    async function PizzasFetch() {\n\n        dispatch(fetchPizzas({\n            order,\n            sortPut,\n            category,\n            search,\n            currentPage\n        }))\n        window.scrollTo(0, 0)\n    }\n    // если есть URL парсим обьект, передаем в стейт, даем запрос на сервер \n    React.useEffect(() => {\n        if (window.location.search) {\n            const params = qs.parse(window.location.search.substring(1))\n            dispatch(setParams({\n                ...params,\n                sort: list.find((el) => el.sortProperty === params.sortProperty)\n            }))\n        }\n        isSearch.current = true // говорим, что диспатч выполнил свою работу\n    }, [])\n\n    //если не было запроса по втановленому URL ( так как выше функция не исполнилась и не изменила на true)\n    React.useEffect(() => {\n        window.scrollBy(0, 0)\n        // выполняется толкьо после смены isSearch.current = true \n        //  если нет URL вставленого, то отправляем запрос по дефолту с инишелСтейт\n        if (!isSearch.current) {\n            PizzasFetch()\n        }\n        isSearch.current = false\n        // я сделал по своему так: у меня по другому не работает> оставлю на всякий \n        // если нет URL вставленого, то отправляем запрос по дефолту с инишелСтейт\n        if (window.location.search === '') {\n            PizzasFetch()\n        }\n\n    }, [CategoryId, sort, currentPage, searchValue])\n    // если второй и более рендеринг - вставляем URL прийдящий с state\n    React.useEffect(() => {\n        if (isMounter.current) {\n            const queryString = qs.stringify({\n                sortProperty: sort.sortProperty,\n                CategoryId,\n                currentPage\n            })\n            navigate(`?${queryString}`)\n        }\n        isMounter.current = true\n    }, [CategoryId, sort, currentPage])\n\n    function setСategories(index) {\n        dispatch(setCategoryId(index))\n    } // или сразу можно передать в пропсы этот кол бек \n\n    function onChangeCurrent(n) {\n        dispatch(setCurrentPage(n))\n    }\n\n    return (\n        <div className=\"container\">\n            <div>\n                <div className=\"content__top\">\n                    <Sort />\n                    <Categories value={CategoryId} onClickCategories={setСategories} />\n                </div>\n                <h2 className=\"content__title\">Все пиццы</h2>\n                <div className=\"content__items\">\n                    {message === 'Пиц не найдено' ? <div> пиц нету уходи / message: {message} </div> :\n                        status === 'error' ?\n                            <NoContent /> : status === 'pending' ? SkeletonArr : Pizzas}\n                </div>\n            </div>\n            <Pagination currentPage={currentPage} onChangeCurrent={onChangeCurrent} />\n        </div>\n    )\n}\n\nexport default Home"],"mappings":"mgBAAA,MAAOA,MAAK,KAAM,OAAO,CACzB,MAAOC,SAAQ,KAAM,kCAAkC,CACvD,MAAOC,UAAS,KAAM,yBAAyB,CAC/C,MAAOC,WAAU,KAAM,0BAA0B,CACjD,MAAOC,KAAI,KAAM,oBAAoB,CACrC,MAAOC,WAAU,KAAM,0BAA0B,CACjD,OAASC,IAAI,KAAQ,oBAAoB,CACzC,MAAOC,UAAS,KAAM,yBAAyB,CAC/C,MAAOC,GAAE,KAAM,IAAI,CACnB,OAASC,WAAW,CAAEC,IAAI,KAAQ,kBAAkB,CACpD,OAASC,WAAW,CAAEC,WAAW,KAAQ,aAAa,CACtD,OAASC,aAAa,CAAEC,cAAc,CAAEC,SAAS,CAAEC,YAAY,KAAS,6BAA6B,CACrG,OAASC,WAAW,CAAEC,WAAW,KAAQ,4BAA4B,CACrE;AAAA,wFAEA,GAAMC,KAAI,CAAG,QAAPA,KAAI,EAAS,CACf,GAAMC,SAAQ,CAAGpB,KAAK,CAACqB,MAAM,CAAC,KAAK,CAAC,CACpC,GAAMC,UAAS,CAAGtB,KAAK,CAACqB,MAAM,CAAC,KAAK,CAAC,CACrC;AACA,GAAME,SAAQ,CAAGd,WAAW,EAAE,CAC9B,GAAMe,SAAQ,CAAGZ,WAAW,EAAE,CAC9B,iBAAuDD,WAAW,CAACK,YAAY,CAAC,CAAxES,IAAI,cAAJA,IAAI,CAAEC,UAAU,cAAVA,UAAU,CAAEC,WAAW,cAAXA,WAAW,CAAEC,WAAW,cAAXA,WAAW,CAClD;AACA;AACA,kBAAoCjB,WAAW,CAACO,WAAW,CAAC,CAApDW,MAAM,eAANA,MAAM,CAAEC,MAAM,eAANA,MAAM,CAAEC,OAAO,eAAPA,OAAO,CAC/B,GAAMC,OAAM,CAAGH,MAAM,CAACI,GAAG,CAAC,SAACC,GAAG,CAAK,CAC/B,mBAAO,KAAC,SAAS,kBAA6BA,GAAG,EAA1BA,GAAG,CAACC,EAAE,CAACC,QAAQ,EAAE,CAAa,CACzD,CAAC,CAAC,CACF,GAAMC,YAAW,CAAG,mBAAI,GAAIC,MAAK,CAAC,CAAC,CAAC,EAAEL,GAAG,CAAC,SAACM,EAAE,CAAEC,KAAK,qBAAK,KAAE,QAAQ,IAAMA,KAAK,CAAI,GAAC,CACnF;AACA,GAAMC,MAAK,CAAGhB,IAAI,CAACiB,YAAY,CAACC,KAAK,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,GAAK,GAAG,CAAG,MAAM,CAAG,KAAK,CACrE,GAAMC,QAAO,CAAGnB,IAAI,CAACiB,YAAY,CAACG,OAAO,CAAC,GAAG,CAAE,EAAE,CAAC,CAClD,GAAMC,SAAQ,CAAGpB,UAAU,CAAG,CAAC,qBAAgBA,UAAU,EAAK,EAAE,CAChE,GAAMqB,OAAM,CAAGnB,WAAW,kBAAaA,WAAW,EAAK,EAAE,CACzD;AAAA,QACeoB,YAAW,8CAW1B;AAAA,+FAXA,qIAEIxB,QAAQ,CAACP,WAAW,CAAC,CACjBwB,KAAK,CAALA,KAAK,CACLG,OAAO,CAAPA,OAAO,CACPE,QAAQ,CAARA,QAAQ,CACRC,MAAM,CAANA,MAAM,CACNpB,WAAW,CAAXA,WACJ,CAAC,CAAC,CAAC,CACHsB,MAAM,CAACC,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAC,uDACxB,8CAEDlD,KAAK,CAACmD,SAAS,CAAC,UAAM,CAClB,GAAIF,MAAM,CAACG,QAAQ,CAACL,MAAM,CAAE,CACxB,GAAMM,OAAM,CAAG7C,EAAE,CAAC8C,KAAK,CAACL,MAAM,CAACG,QAAQ,CAACL,MAAM,CAACQ,SAAS,CAAC,CAAC,CAAC,CAAC,CAC5D/B,QAAQ,CAACT,SAAS,gCACXsC,MAAM,MACT5B,IAAI,CAAEnB,IAAI,CAACkD,IAAI,CAAC,SAACjB,EAAE,QAAKA,GAAE,CAACG,YAAY,GAAKW,MAAM,CAACX,YAAY,GAAC,GAClE,CAAC,CACP,CACAtB,QAAQ,CAACqC,OAAO,CAAG,IAAI,CAAC;AAC5B,CAAC,CAAE,EAAE,CAAC,CAEN;AACAzD,KAAK,CAACmD,SAAS,CAAC,UAAM,CAClBF,MAAM,CAACS,QAAQ,CAAC,CAAC,CAAE,CAAC,CAAC,CACrB;AACA;AACA,GAAI,CAACtC,QAAQ,CAACqC,OAAO,CAAE,CACnBT,WAAW,EAAE,CACjB,CACA5B,QAAQ,CAACqC,OAAO,CAAG,KAAK,CACxB;AACA;AACA,GAAIR,MAAM,CAACG,QAAQ,CAACL,MAAM,GAAK,EAAE,CAAE,CAC/BC,WAAW,EAAE,CACjB,CAEJ,CAAC,CAAE,CAACtB,UAAU,CAAED,IAAI,CAAEE,WAAW,CAAEC,WAAW,CAAC,CAAC,CAChD;AACA5B,KAAK,CAACmD,SAAS,CAAC,UAAM,CAClB,GAAI7B,SAAS,CAACmC,OAAO,CAAE,CACnB,GAAME,YAAW,CAAGnD,EAAE,CAACoD,SAAS,CAAC,CAC7BlB,YAAY,CAAEjB,IAAI,CAACiB,YAAY,CAC/BhB,UAAU,CAAVA,UAAU,CACVC,WAAW,CAAXA,WACJ,CAAC,CAAC,CACFJ,QAAQ,YAAKoC,WAAW,EAAG,CAC/B,CACArC,SAAS,CAACmC,OAAO,CAAG,IAAI,CAC5B,CAAC,CAAE,CAAC/B,UAAU,CAAED,IAAI,CAAEE,WAAW,CAAC,CAAC,CAEnC,QAASkC,cAAa,CAACrB,KAAK,CAAE,CAC1BhB,QAAQ,CAACX,aAAa,CAAC2B,KAAK,CAAC,CAAC,CAClC,CAAE;AAEF,QAASsB,gBAAe,CAACC,CAAC,CAAE,CACxBvC,QAAQ,CAACV,cAAc,CAACiD,CAAC,CAAC,CAAC,CAC/B,CAEA,mBACI,aAAK,SAAS,CAAC,WAAW,wBACtB,oCACI,aAAK,SAAS,CAAC,cAAc,wBACzB,KAAC,IAAI,IAAG,cACR,KAAC,UAAU,EAAC,KAAK,CAAErC,UAAW,CAAC,iBAAiB,CAAEmC,aAAc,EAAG,GACjE,cACN,WAAI,SAAS,CAAC,gBAAgB,+DAAe,cAC7C,YAAK,SAAS,CAAC,gBAAgB,UAC1B9B,OAAO,GAAK,gBAAgB,cAAG,iHAAiCA,OAAO,OAAQ,CAC5ED,MAAM,GAAK,OAAO,cACd,KAAC,SAAS,IAAG,CAAGA,MAAM,GAAK,SAAS,CAAGO,WAAW,CAAGL,MAAM,EACjE,GACJ,cACN,KAAC,UAAU,EAAC,WAAW,CAAEL,WAAY,CAAC,eAAe,CAAEmC,eAAgB,EAAG,GACxE,CAEd,CAAC,CAED,cAAe3C,KAAI"},"metadata":{},"sourceType":"module","externalDependencies":[]}